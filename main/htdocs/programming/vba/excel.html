<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1">	
  <title>Excel</title>
  <meta name="AUTHOR" content="Mark">
</head>


<body bgcolor="#ffffff">

<a href="../../index.html">Home</a> : 
<a href="../programming.htm">programming</a>  :
<a href="vba.htm">vba</a>

<p>Sundry notes for Excel</p>



<h2>Alerts: Activating/deactivating</h2>


<p>How to turn the default alerts on or off:</p>
<pre>Application.DisplayAlerts = True '/False</pre>




<h2>Charts: Exporting</h2>

<p>The simplest way of saving a chart is:</p>

<pre>fname = ThisWorkbook.Path &amp; "\" &amp; ActiveChart.Name &amp;    ".gif"<br>ActiveChart.Export Filename:=fname, FilterName:="GIF"</pre>

<p>For more control, use something like:

<pre>Dim ch As Chart<br>Set ch = ThisWorkbook.Sheets("Whatever").ChartObjects("Chart 1").Chart<br>ch.Export Filename:="mychart.gif", FilterName:="GIF"</pre>



<h2>File dialog boxes</h2>


<p>How to create a File Open dialog box to allow the user to specifiy a file, 
  so that you can read it.</p>


<blockquote>
  
  <pre>fileToOpen = Application.GetOpenFilename <br>If (fileToOpen = False) Then 'Cancel selected </pre>

</blockquote>




<br>

<h2>Modules</h2>

<p>How to (import and ) export modules programmatically.</p>

<p>&nbsp;</p>

<pre>Public Sub ExportModules()<br>    <br>    Dim wb As Workbook<br>    Set wb = ThisWorkbook<br>    Dim VBComp 'As codemodule<br>    Dim D As String<br>    Dim N<br>    <br>    <br>    D = ThisWorkbook.Path<br>    For Each VBComp In wb.VBProject.VBComponents<br>        If (VBComp.Type = 1) Then 'standard module<br>            N = D + "\" + VBComp.Name + ".bas"<br>            VBComp.Export N<br>        End If<br>    Next<br>    'Set VBComp = wb.VBProject.VBComponents("modModules")<br>    'VBComp.Export pt + "\modModules.bas"<br>    <br>End Sub<br></pre>

<br>

You can get a count on the number of modules as follows:<br>

<pre>x = ThisWorkbook.VBProject.VBComponents.Count<br></pre>

<h2>Path and filenames</h2>


<ul>

  <li>
    <code>ActiveWorkbook.Path</code> gives the directory where the workbook 
is located. It is not terminated by a backslash.
  </li>


  <li><code>ActiveWorkbook.Name</code> returns the filename, including 
extension, of the active workbook</li>


  <li><code>ActiveWorkbook.Fullname</code> returns the directory and 
filename of the active workbook. </li>

</ul>


<br>

<h2>Run Commands</h2>


<p>To run commands given as strings: <code>Application.Run "'WorkbookName.xls'!ModuleName.FunctionName"</code>&nbsp;</p>
<h2>Filing formulae</h2>
Here's some code that sends all the formulae in a workbook to a file.
It is good for discovering links to external spreadsheets that may be
lurking about<br>
<br>
<pre>Public Sub PrintWsFormulae()<br>    Dim ws As Worksheet, r, c, f<br>    Open ThisWorkbook.Path + "\formulae.txt" For Output As #1<br>    For Each ws In ThisWorkbook.Worksheets<br>        Print #1, ws.name<br>        <br>        For r = 1 To NumRows(ws)<br>        For c = 1 To NumCols(ws)<br>            f = ws.Cells(r, c).Formula<br>            If Len(f) &gt; 0 And Not IsNumeric(f) Then<br>                Print #1, r, " ", c, " ", f<br>            End If<br>        Next<br>        Next<br>        Print #1, ""<br>        <br>    Next<br>    Close #1<br>End Sub<br></pre>


<h2>Worksheet modules</h2>

If a worksheet might or might not have a specific sub, you can test and call it using:

<pre>
Public Function DoSomething(ws As Worksheet)
   Dim WbName
   DoSomething = False
   WbName = ws.Parent.name
   On Error Resume Next 
   DoSomething = Workbooks(WbName).Worksheets(ws.name).MyFunction(key)
   On Error GoTo 0
End Function
</pre>

It also works with subroutines.





<hr><h2>Determine the rows selected by the user</h2>

<pre>
Private Sub mysub()
   Dim r, rng As Range
   Set rng = ActiveWindow.RangeSelection.Rows
   For r = rng.Row To rng.Row + rng.Count - 1
       Debug.Print r
   Next
End Sub
</pre>

<hr><h2>External Links </h2>

<ul>

  <li><a href="http://www.j-walk.com/ss/excel/index.htm">http://www.j-walk.com/ss/excel/index.htm</a></li>

</ul>


<hr><pre>
Author:  Mark Carter
Updated: 16-May-2009
</pre>
</body>
</html>
